{% extends 'posts/base.html' %} {% block content %} {% load static %}

<div class="ask-wrap">
  <h1>질문하기</h1>
  <form enctype="multipart/form-data" method="POST" action="." id="askForm">
  
    {% csrf_token %}
    <br />

    {% comment %} <label for="image"></label>

    <input
      type="file"
      name="profile_image"
      multiple="multiple"
      id="image"
      accept="image/*"
      required=""
      onchange="readURL(this);"
    />
    {% endcomment %}

    <br />
    {% comment %} <label for="id_item_image">Item image:</label>
    <input
      type="file"
      name="item_image"
      multiple
      accept="image/*"
      id="gallery-photo-add"
    /> {% endcomment %}
    <div class="gallery" id="id_item_image"></div>

    <br />
    

    <div class="image-upload-wrap">
      <input
        id="image"
        class="file-upload-input"
        type="file"
        onchange="readURL(this);"
        accept="image/*"
        style="display: none"
      />
    </div>

    <br />

    <div class="file-upload-content">
      <img
        style="display: none"
        class="file-upload-image"
        src="{{ user.profile_image.url }}"
        alt="your image"
        width="240"
        onclick="$('.file-upload-input').trigger( 'click' )"
      />
    </div>

    <br />
    
    <button id="showImages" style="display: none"></button>

    <br />
    
    {% comment %} 원래 이 아래에 src 들어가면 기본으로 이미지를 보여주는것
    src="{{ user.profile_image.url }}" {% endcomment %}

    <div class="test_div"></div>

    <img
      class="file-upload-image1"
      id="previewImg"
      style="max-width: 80%; max-height: 80%; height: auto; width: auto"
    />
    <img
      class="file-upload-image2"
      id="previewImg"
      style="max-width: 80%; max-height: 80%; height: auto; width: auto"
    />
    <img
      class="file-upload-image3"
      id="previewImg"
      style="max-width: 80%; max-height: 80%; height: auto; width: auto"
    />

    <br />

    <div id="imageField"></div>

    <br />

    <div class="image-upload-wrap" style="display: none">
      <input
        id="image"
        class="file-upload-input"
        type="file"
        onchange="readURL(this);"
        accept="image/*"
        style="display: block"
      />
    </div>

    <br />

    {{ form.media }}<br />

    {% comment %} <p>
      <label for="id_item_image">Item image:</label>
      <input
        type="file"
        name="item_image"
        multiple
        accept="image/*"
        id="id_item_image"
      />
    </p> {% endcomment %}

    <p></p>
    <br />
    {% comment %} {{ form.as_p }} {% endcomment %}
    <p><label for="id_title">Title:</label> <input type="text" name="title" maxlength="128" required id="id_title"></p>
    <p>
    <label for="id_category">Category:</label>
    <select name="category" id="id_category">
      <option value="상의" selected>상의</option>
      <option value="하의">하의</option>
      <option value="신발">신발</option>
      <option value="기타">기타</option>
    </select></p>
    <p><label for="id_brand">Brand:</label> <input type="text" name="brand" maxlength="128" required id="id_brand"></p>
    <p><label for="id_price">Price:</label> <input type="text" name="price" maxlength="128" required id="id_price"></p>
    <p><label for="id_link">Link:</label> <input type="text" name="link" maxlength="128" id="id_link"></p>
    <p><label for="id_item_image">Item image:</label> <input type="file" name="item_image" multiple accept="image/*" id="gallery-photo-add"></p>
    <p>
    <label for="id_ckcontent">Ckcontent:</label>
    <div class="django-ckeditor-widget" data-field-id="id_ckcontent" style="display: inline-block;">
        <textarea cols="40" id="id_ckcontent" name="ckcontent" rows="10" required data-processed="0" data-config="{&quot;skin&quot;: &quot;moono-lisa&quot;, &quot;toolbar_Basic&quot;: [[&quot;Source&quot;, &quot;-&quot;, &quot;Bold&quot;, &quot;Italic&quot;]], &quot;toolbar_Full&quot;: [[&quot;Styles&quot;, &quot;Format&quot;, &quot;Bold&quot;, &quot;Italic&quot;, &quot;Underline&quot;, &quot;Strike&quot;, &quot;SpellChecker&quot;, &quot;Undo&quot;, &quot;Redo&quot;], [&quot;Link&quot;, &quot;Unlink&quot;, &quot;Anchor&quot;], [&quot;Image&quot;, &quot;Flash&quot;, &quot;Table&quot;, &quot;HorizontalRule&quot;], [&quot;TextColor&quot;, &quot;BGColor&quot;], [&quot;Smiley&quot;, &quot;SpecialChar&quot;], [&quot;Source&quot;]], &quot;toolbar&quot;: &quot;Custom&quot;, &quot;height&quot;: 291, &quot;width&quot;: &quot;auto&quot;, &quot;filebrowserWindowWidth&quot;: 940, &quot;filebrowserWindowHeight&quot;: 725, &quot;toolbar_Custom&quot;: [[&quot;FontSize&quot;], [&quot;Bold&quot;, &quot;Italic&quot;, &quot;Underline&quot;, &quot;Strike&quot;], [&quot;TextColor&quot;], [&quot;Image&quot;]], &quot;filebrowserUploadUrl&quot;: &quot;/ckeditor/upload/&quot;, &quot;filebrowserBrowseUrl&quot;: &quot;/ckeditor/browse/&quot;, &quot;language&quot;: &quot;en-us&quot;}" data-external-plugin-resources="[]" data-id="id_ckcontent" data-type="ckeditortype"></textarea>
    </div>
    </p>
    <br />
    <button type="submit" id="submit_ask" class="btn btn-primary">
      사라마라 질문하기
    </button>
  </form>
  <br />
  <br />
</div>

{% comment %} 음 이건일단 나중에해도 될듯 form 전체를 django 쪽으로 넘기는 함수
{% endcomment %} {% comment %}
<script>
  document.getElementById("submit_ask").onclick = function () {
    $.ajax({
      url: "/ask/",
      method: "POST",
      data: new FormData(askForm),
      processData: false,
      contentType: false,
    }).done(function () {
      window.location.replace("http://192.168.219.159:8000");
    });
  };
</script>
{% endcomment %} {% comment %}
<script>
  document.getElementById("showImages").onclick = function () {
    $.ajax({
      url: "/get_images/",
      method: "GET",
      success: function (data) {
        console.log(data["image_urls"]);
        imageField = document.querySelector("#imageField");
        imageField.appendChild(CreateImage(data["image_urls"]));
      },
    });
  };
</script>
{% endcomment %} {% comment %}
<script>
  function CreateImage(src) {
    let img = document.createElement("img");
    console.log(src);
    img.src = src;
    img.className = "imageSize";
    return img;
  }
</script>
{% endcomment %}

<script>
  $(function () {
    // Multiple images preview in browser
    var imagesPreview = function (input, placeToInsertImagePreview) {
      if (input.files) {
        var filesAmount = input.files.length;

        for (i = 0; i < filesAmount; i++) {
          var reader = new FileReader();

          reader.onload = function (event) {
            $(
              $.parseHTML(
                "<img style='max-width: 80%; max-height: 80%; height: auto; width: auto'>"
              )
            )
              .attr("src", event.target.result)
              .appendTo(placeToInsertImagePreview);
          };

          reader.readAsDataURL(input.files[i]);
        }
      }
    };

    $("#gallery-photo-add").on("change", function () {
      imagesPreview(this, "div.gallery");
      imagesPreview(this, "div.mySlides");
    });
  });
</script>
<script
  type="text/javascript"
  src="{% static 'ckeditor/ckeditor-init.js' %}"
></script>
<script
  type="text/javascript"
  src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"
></script>

{% comment %}
<script>
  function readURL(input) {
    var frameArray = [];
    var Array1 = [];
    for (var num_pic = 0; num_pic < input.files.length; num_pic++) {
      f = input.files[num_pic];
      //frameArray[num_pic] = ;
      //if (input.files && input.files[0]) {
      var reader = new FileReader();
      form_data = new FormData();
      $(".test_div").append("<img class=add_img" + num_pic + ">");

      reader.onload = function (e) {
        //$(".image-upload-wrap").hide();
        //$(".test_div").append(
        //  '<img id="theImg" src="e.target.result" />'
        //);
        //console.log(num_pic);
        //$(".test_div").append("<img id=" + num_pic + ">");
        //$("#" + num_pic).attr("src", e.target.result);

        //$("#theImg").attr("id", i);
        //$("#theImg > #" + i).attr("src", e.target.result);
        Array1.push("???");
        frameArray.push(e.target.result);
        console.log(num_pic);
        //console.log(e.target);
        $(".add_img").attr("src", e.target.result);
        $(".add_img").attr("class", "done");

        $(".file-upload-image1").attr("src", e.target.result);

        //$("#test_div").prepend('<img id="theImg" src="e.target.result" />');
        //$("#test_div").append(
        //   $("<img>", { id: "theImg", src: e.target.result })
        // );

        //var added_img = $("<img>", { id: "theImg", src: e.target.result });

        //$("#test_div").appendChild(added_img);
        //document.getElementById("test_div").appendChild(added_img);
        //$(".theImg").attr("src", e.target.result); // (line 4)

        //$(".file-upload-content").show();
        //$(".image-title").html(input.files[0].name);
      };
      reader.readAsDataURL(f);

      //reader.readAsDataURL(input.files[0]);
      //} else {
      //removeUpload();
      //}
      console.log(num_pic);
      $(".add_img" + num_pic).attr("src", frameArray[num_pic]);
      console.log(frameArray[num_pic]);
    }
    console.log(frameArray);
    console.log(Array1[0]);
  }
</script>
{% endcomment %} {% comment %}
<script>
  function removeUpload() {
    $(".file-upload-input").replaceWith($(".file-upload-input").clone());
    //$(".file-upload-content").hide();
    //$(".file-upload-content").show();
    $(".file-upload-image").attr("src", "{{ user.profile_image.url }}");
    $(".image-upload-wrap").hide();
    //$(".image-upload-wrap").show();
  }
</script>

{% endcomment %} {% endblock %}

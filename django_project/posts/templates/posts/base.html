<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>사라마라</title>

    {% comment %} 카카오 로그인 javascript {% endcomment %}
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
{% comment %}   
    <script>
      // SDK를 초기화 합니다. 사용할 앱의 JavaScript 키를 설정해 주세요.
      Kakao.init("a4eec100dca8ea84b93b538f6187d07a");
      // 우선 넣고 나중에 재발행 해서 바꾸기
      console.log("hello");

      // SDK 초기화 여부를 판단합니다.
      console.log(Kakao.isInitialized());
      Kakao.Auth.authorize({
        redirectUri: "http://127.0.0.1:8000",
        scope: "gender"
      });
      {% comment %} const queryString = window.location.search;
      console.log(queryString);
      const urlParams = new URLSearchParams(queryString);
      const token = urlParams.get('code')
      console.log(token);
      Kakao.Auth.setAccessToken(token)
      console.log("work??")
      console.log(Kakao.Auth.setAccessToken(token))
      console.log("setaccesstoken work?")
      Kakao.API.request({
        url: '/v2/user/me',
        success: function(res) {
          alert(JSON.stringify(res))
        },
        fail: function(error) {
          alert(
            'login success, but failed to request user information: ' +
              JSON.stringify(error)
          )
        },
      }) {% endcomment %}
      {% comment %} Kakao.Auth.login({
				// authObj : accessToken, type, expires_in, scope 등 포함
				success: function(authObj) {
					// alert('login success: ' + JSON.stringify(authObj)),
					// 유저 인포 불러오기
					Kakao.API.request({
						url: '/v2/user/me',
						success: function(res){
							alert('login success: ' + JSON.stringify(authObj) + '\n user info: ' + JSON.stringify(res))
						}
					}),
					// API 요청
					Kakao.API.request({
						// 나에게 보내기 API 주소
						url: '/v2/api/talk/memo/send',
						data: {
							// 커스텀 템플릿 아이디
							template_id: 32861,
							// templateArgs: {"title": "Kakao msg forwarded from the web","description": "AIA semi-final project"}
						},
						success: function(res) {
							alert('msg success: ' + JSON.stringify(res))},
						fail: function(err) {
							alert('msg error: ' + JSON.stringify(err))},
					})
				},
				fail: function(err) {
		        	alert('failed to login: ' + JSON.stringify(err))},
			})
      console.log("request work?") {% endcomment %}
      {% comment %} console.log(document.cookie)
    const token = getCookie('authorize-access-token')
    Kakao.Auth.setAccessToken(token)
    function getCookie(name) {
    const value = "; " + document.cookie;
    const parts = value.split("authorize-access-token=");
    if (parts.length === 2) return parts.pop().split(";").shift();
  } {% endcomment %}



    {% comment %} </script> {% endcomment %}

    {% load static %}
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'posts/style.css' %}"
    />
    
    <script src="{% static 'posts/myScript1.js' %}"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"
    />
    <script src="myScript1.js"></script>
    <script src="demo.js"></script>
  </head>

  <body style="background-color: black;">
    <!--    base layout-->
    <div class="mylayout" style="background-color: white;">
      <!--        site header-->
      <header>
        <a href="{% url 'posts:index' %}">
          사라마라
        </a>
        {% if user.is_authenticated %}
        <a
          class="btn btn-default"
          href="{% url 'posts:ask' %}"
          style="float: right;"
          >New Post</a
        >
        <p style="float: right;">
            <div style="font-size: 2rem; color: green; display: inline; float: right;">Welcome, {{ user.username }}
                <small>(<a href="{% url 'posts:signout' %}">LogOut</a>)</small>
                &nbsp;&nbsp;
            </div>
        </p>
        {% else %}
        <div style="float: right;">
          <a class="btn btn-default" href="{% url 'posts:signup' %}"
            >Sign up</a
          >
          <a class="btn btn-default" href="{% url 'posts:signin' %}">SignIn</a>
          {% comment %} <a class="btn btn-default" href="{% url 'posts:kakaologin' %}">kakaologin</a> {% endcomment %}
        </div>
        {% endif %}
      </header>
      <!--        site header-->

    <a id="custom-login-btn" href="javascript:loginWithKakao()">
      <img
        src="//k.kakaocdn.net/14/dn/btqCn0WEmI3/nijroPfbpCa4at5EIsjyf0/o.jpg"
        width="222"
      />
    </a>
    <script type="text/javascript">
      function loginWithKakao() {
        Kakao.init("a4eec100dca8ea84b93b538f6187d07a");
        // 우선 넣고 나중에 재발행 해서 바꾸기
        
        // SDK 초기화 여부를 판단합니다.
        console.log(Kakao.isInitialized());
        
        Kakao.Auth.login({
          success: function(authObj) {
            alert(JSON.stringify(authObj))
          },
          fail: function(err) {
            alert(JSON.stringify(err))
          },
        })
      }
    </script>



    {% comment %} <a id="custom-login-btn" href="javascript:loginWithKakao()">
      <img
        src="//k.kakaocdn.net/14/dn/btqCn0WEmI3/nijroPfbpCa4at5EIsjyf0/o.jpg"
        width="222"
      />
    </a>
    <p id="token-result"></p>
    <script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>

    

    <script type="text/javascript">
      // 웹 플랫폼 도메인 등 초기화한 앱의 설정이 그대로 적용됩니다.
      // 초기화한 앱에 현재 도메인이 등록되지 않은 경우 에러가 발생합니다.
      Kakao.init("a4eec100dca8ea84b93b538f6187d07a")
      console.log(Kakao.isInitialized());
      function loginWithKakao() {
        console.log(Kakao.isInitialized());
        Kakao.Auth.authorize({
          // 초기화한 앱의 로그인 Redirect URI에 등록된 URI여야 합니다.
          redirectUri: "http://127.0.0.1:8000",
        })
      }
      console.log("value is")
      console.log("authorize-access-token")
      const queryString = window.location.search;
      console.log(queryString);
      const urlParams = new URLSearchParams(queryString);
      {% comment %} const token = urlParams.get('code') 
      const token = "0UePcPokwYJxVKRcNRx7mZ-FZq2-mZ5y2qLMHgo9dBEAAAF2NqI9pw"
      console.log(token);
      Kakao.Auth.setAccessToken(token)
      console.log("work??")
      console.log(Kakao.Auth.setAccessToken(token))
      console.log(document.cookie)
      // 아래는 데모를 위한 UI 코드입니다.
      getToken()
      function getToken() {
        console.log("it is gettoken function")
        const token = getCookie("authorize-access-token")
        console.log("it is token value")
        console.log(token)
        if (token) {
          Kakao.Auth.setAccessToken(token)
        }
      }
      function getCookie(name) {
        console.log("it is getcookie function")
        console.log(name)
        console.log("it is document.cookie value")
        console.log(document.cookie)
        const value = "; " + document.cookie
        console.log(value)
        const parts = value.split("; " + name + "=")
        console.log("parts is")
        console.log(parts)
        console.log(parts.length)
        if (parts.length === 2) return parts.pop().split(";").shift()
      }
    </script> {% endcomment %}



      <!--        floating button nav-->
      <div class="dropdown">
        <button onclick="myFunction()" class="dropbtn"></button>
        <div id="myDropdown" class="dropdown-content">
          {% if user.is_authenticated %}
          <a href="{% url 'posts:mypage' %}">마이페이지</a>
          <div class="dropdown-divider"></div>
          <a href="{% url 'posts:ask' %}">질문하기</a>
          <a href="{% url 'posts:index' %}">답해주기</a>
          {% else %}
          <a href="{% url 'posts:signin' %}">마이페이지</a>
          <div class="dropdown-divider"></div>
          <a href="{% url 'posts:signin' %}">질문하기</a>
          <a href="{% url 'posts:index' %}">답해주기</a>
          {% endif %}
        </div>
      </div>
      {% block content %}
      {% endblock %}
      <footer>
        <h1>copyright 사라마라</h1>
      </footer>
      <!--        site footer-->
    </div>

    <!--    link js file myScript1.js-->
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"
    ></script>
    <script type="text/javascript" src="myScript1.js"></script>
    <script src="myScript1.js"></script>
    <!--    link js file myScript1.js-->
  </body>
</html>

{% extends 'posts/base.html' %} {% block content %} {% load static %}

<script>
  $(document).ready(function () {
    $("#add_comment_button").click(function () {
      var comment_input = $("#comment_input").val();
      var current_url = $(location).attr("pathname"); // + "add_comment/";
      $.ajax({
        type: "POST",
        url: current_url, //"/add_comment/",
        data: { comment_input: comment_input },
      }).done(function () {
        location.reload();
        $("#comment_input").val("");
      });
    });
  });
</script>

<script>
  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      form_data = new FormData();

      reader.onload = function (e) {
        $(".image-upload-wrap").hide();
        $(".file-upload-image").attr("src", e.target.result);

        $(".file-upload-content").show();
        $(".image-title").html(input.files[0].name);
      };

      reader.readAsDataURL(input.files[0]);
    } else {
      removeUpload();
    }
  }
</script>
<script>
  function removeUpload() {
    $(".file-upload-input").replaceWith($(".file-upload-input").clone());
    //$(".file-upload-content").hide();
    //$(".file-upload-content").show();
    $(".file-upload-image").attr("src", "{{ user.profile_image.url }}");
    $(".image-upload-wrap").hide();
    //$(".image-upload-wrap").show();
  }
</script>

<script>
  function editComment(input) {
    console.log(input);
    var text = $(".comment_" + input + ">div.text")
      .html()
      .replaceAll("<p>", "")
      .replaceAll("</p>", "")
      .replaceAll("<br>", "\n")
      .replaceAll("      ", "")
      .replaceAll("\n    ", "");
    console.log(text);
    $(".comment_" + input + ">div.text").html(
      "<textarea id='newComment' rows='4' cols='40'>" + text + "</textarea>"
    );
    $(".edit_delete_button").hide();
    $(".edit_button_" + input + "").show();
  }
</script>

<script>
  function clickeditComment(input) {
    console.log(input);
    var new_comment = $("#newComment").val();
    console.log(new_comment);

    var current_url = $(location).attr("pathname");
    console.log(current_url);
    $.ajax({
      type: "POST",
      url: current_url,
      data: { new_comment: new_comment, pk: input },
      //csrfmiddlewaretoken: {{ csrf_token }},
    }).done(function () {
      location.reload();
    });
  }
</script>

<script>
  function deletePost(input) {
    if (confirm("정말 삭제하시겠습니까?") == true) {
      //확인
      var current_url = $(location).attr("pathname");
      console.log("%%%%%%%%%%");
      console.log(current_url);
      $.ajax({
        type: "POST",
        url: current_url,
        data: { delete_post: input },
        //csrfmiddlewaretoken: {{ csrf_token }},
      }).done(function () {
        window.location.replace("http://192.168.219.104:8000");
      });
    } else {
      //취소
      return;
    }
  }
</script>

<script>
  function deleteComment(input) {
    if (confirm("정말 삭제하시겠습니까?") == true) {
      //확인
      var current_url = $(location).attr("pathname");
      $.ajax({
        type: "POST",
        url: current_url,
        data: { delete_comment_pk: input },
        //csrfmiddlewaretoken: {{ csrf_token }},
      }).done(function () {
        location.reload();
      });
    } else {
      //취소
      return;
    }
  }
</script>

<br />
<script>
  $("#plz_login_sara").click(function () {
    alert("이건 사야한다!! 투표하려면 로그인을 해주세요");
  });
</script>
<br />
<br />
<script>
  $("#plz_login_mara").click(function () {
    alert("이건 절대아니다!! 투표하려면 로그인을 해주세요");
  });
</script>

<script>
  $("#sarabutton").click(function () {
    var current_url = $(location).attr("pathname"); // + "sara/";
    var saramara_data = "sara";
    $.ajax({
      type: "POST",
      url: current_url,
      data: { saramara_input: saramara_data },
    }).done(function () {
      location.reload();
    });
  });
</script>

<script>
  $("#marabutton").click(function () {
    var current_url = $(location).attr("pathname"); // + "mara/";
    var saramara_data = "mara";
    $.ajax({
      type: "POST",
      url: current_url,
      data: { saramara_input: saramara_data },
    }).done(function () {
      location.reload();
    });
  });
</script>

<script>
  var current_url = $(location).attr("href");
  console.log(current_url);
  Kakao.Link.createDefaultButton({
    container: "#create-kakao-link-btn",
    objectType: "feed",
    content: {
      title: "포스트 제목을 여기에 가져와야 함",
      description:
        "여기에는 포스트 ckcontent 가져와야 함 #사라 #마라 #사이트 #테스트 #해쉬태그를 해야하나",
      imageUrl:
        "https://cdn.pixabay.com/photo/2018/06/04/00/29/women-3452067_1280.jpg",
      link: {
        // mobileWebUrl: "https://developers.kakao.com",
        // webUrl: "https://developers.kakao.com",
        mobileWebUrl: current_url,
        webUrl: current_url,
      },
    },
    social: {
      likeCount: 286, // 이걸 사라, 마라, 댓글, 조회수, 공유수 로 바꿀수가 있나?
      commentCount: 45,
      sharedCount: 845,
    },
    /*buttons: [
      {
        title: "웹으로 보기",
        link: {
          mobileWebUrl: "https://developers.kakao.com",
          webUrl: "https://developers.kakao.com",
        },
      },
      {
        title: "앱으로 보기",
        link: {
          mobileWebUrl: "https://developers.kakao.com",
          webUrl: "https://developers.kakao.com",
        },
      },
    ],*/
  });
</script>
<br />
<br />
<script
  type="text/javascript"
  src="{% static 'ckeditor/ckeditor-init.js' %}"
></script>
<script
  type="text/javascript"
  src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"
></script>
<!--        item filter-->

<br /><br /><br /><br /><br /><br />

<!--        각 item detail 이 가지는 기본 정보, 혹은 보여지는 정보를 따로 표시-->
<div>
  <h1>
    <div style="font-size: 25px; font-weight: bold">
      {{ post.title | upper}}
    </div>
    <br />
    <a
      class="main_home_user"
      style="
        font-size: 20px;
        font-weight: bold;
        vertical-align: middle;
        vertical-align: middle;
        text-align: center;
        display: inline-flex;
      "
    >
      <img
        src="{{ post.author.profile_image.url }}"
        style="
          width: 29px;
          height: 29px;
          border: 1px solid #000;
          border-radius: 30px;
        "
      />
      <p>{{ post.author.username}}</p>
    </a>
    <div style="font-size: 13px; font-weight: bold">
      사라{{post.sara_cnt}} 마라{{post.mara_cnt}} 댓글{{post.comment_cnt}}
      조회{{post.view_cnt}}
    </div>
    <br />
    <div style="font-size: 11px; font-weight: bold">{{post.get_pub_date}}</div>
  </h1>
</div>

{% if user.is_authenticated %} {% if post.author.id == user.id %}
<input
  type="submit"
  name="delete_post_button"
  value="삭제"
  class="btn"
  onclick="deletePost('{{post.id}}')"
/>
<br />

{% endif %} {% endif %}

<!--        각 item detail 이 가지는 기본 정보, 혹은 보여지는 정보를 따로 표시-->
<br />
<!--        작성한 내용을 container 라는 div 안에 담아서 표현-->
<div class="ckbody">
  <p>카테고리 : {{ post.category }}</p>
  <br />
  <p>가격 : {{ post.price }}</p>
  <br />
  <p>브랜드 : {{ post.brand }}</p>
  <br />
  <p>링크 : {{ post.link }}</p>
  <br />
  <p>{{ post.content }}</p>

  {% comment %}
  <p style="max-width: 400px; height: auto">{{ post.ckcontent|safe }}</p>
  {% endcomment %}
  <p>{{ post.ckcontent|safe }}</p>

  <h1>투표공간</h1>

  <!-- bootstrp 써서 색깔? 같은거 하고, a:click 은 색깔 칠해진걸로 해서 투표 한걸 보이게끔 버튼 변경 css 부분 -->

  <br />
  {% if user.is_authenticated %}
  <input
    id="sarabutton"
    type="submit"
    name="sara_button"
    value="이건사야지"
    class="btn btn-primary"
  />
  {% else %}
  <input
    id="plz_login_sara"
    type="submit"
    name="sara_button"
    value="이건사야지"
    class="btn btn-primary"
  />
  {% endif %}

  <br />
  {% if user.is_authenticated %}
  <input
    id="marabutton"
    type="submit"
    name="mara_button"
    value="이건아니지"
    class="btn btn-primary"
  />
  {% else %}
  <input
    id="plz_login_mara"
    type="submit"
    name="mara_button"
    value="이건아니지"
    class="btn btn-primary"
  />
  {% endif %}

  <input
    type="submit"
    class="btn btn-primary"
    id="vote-result"
    value="결과보기"
  />

  <div class="vote-result-area" style="display: none">
    <form method="GET" action=".">
      <div class="items-sort">
        <h2>사라!! : {{ post.sara_cnt }}</h2>
        <h2>마라!! : {{ post.mara_cnt }}</h2>
        <h3>사라한사람 : {{ post.sara }}</h3>
        <h3>마라한사람 : {{ post.mara }}</h3>
        <h3>
          여기 아이디 적히는 사람들의 유저 정보중 성별/생년월일을 가져와야 함
          로그인 해야 결과 보는걸로 바꿔야 함
        </h3>
      </div>
      <br />
      <br />
    </form>
  </div>
  <br />
  <h1>공유하기</h1>
</div>
<!--        작성한 내용을 container 라는 div 안에 담아서 표현-->
<br />
<a id="create-kakao-link-btn" href="javascript:;">
  <img
    src="https://developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_medium.png"
  />
</a>

<br />
<!--        현재의 빈 공간 / 미래의 광고창-->
<div>
  <h1>빈 공간</h1>
</div>
<br />
<!--        현재의 빈 공간 / 미래의 광고창-->
<!--        댓글 공간-->
<div>
  <h1>댓글창 with pagination</h1>
  <!-- {{comment}} -->

  {% for element in comment %} author {{element.author.id}} <br />
  <div class="comment_{{element.id}}">
    user {{user.id}} <br />
    <strong>{{element.author}}</strong> <br />
    <div class="text">
      <p>{{element.text|linebreaks}}</p>
    </div>
    -
    <p class="created_date">{{element.get_created_date}}</p>

    <br />

    {% if element.author.id == user.id %}
    <div class="edit_delete_button">
      <input
        type="submit"
        value="삭제"
        class="btn"
        onclick="deleteComment('{{element.id}}')"
      />

      <input
        type="submit"
        value="수정"
        class="btn"
        onclick="editComment('{{element.id}}')"
      />
    </div>
    <div class="edit_button_{{element.id}}" style="display: none">
      <input
        type="submit"
        name="edit_comment_button"
        value="댓글수정"
        class="btn"
        id="edit_comment_button"
        onclick="clickeditComment('{{element.id}}')"
      />
    </div>
  </div>
  {% endif %} {% empty %}
  <p>살지 말지 고민을 해결해주세요 :)</p>

  {% endfor %}
  <br />

  {% if user.is_authenticated %}
  <h1>댓글작성창</h1>
  <!-- <input type="text" name="add_comment" size="100" height="100"><br><br> -->
  <br />

  <textarea
    id="comment_input"
    rows="4"
    name="add_comment"
    placeholder="당신의 의견을 말해주세요"
  ></textarea>

  {% comment %}
  <input
    id="comment_input"
    name="add_comment"
    placeholder="당신의 의견을 말해주세요"
  />
  {% endcomment %}
  <br />
  <input
    id="add_comment_button"
    type="submit"
    name="add_comment_button"
    value="댓글달기"
    class="btn btn-primary"
  />
  {% else %}

  <!-- <input type="text" name="add_comment" size="100" height="100"><br><br> -->
  <textarea
    id="comment_input"
    rows="4"
    cols="40"
    name="add_comment"
    placeholder="로그인 후 당신의 의견을 말해주세요"
  ></textarea>

  <br />
  <a id="custom-login-btn" href="javascript:loginWithKakao()">
    <img
      src="//k.kakaocdn.net/14/dn/btqCn0WEmI3/nijroPfbpCa4at5EIsjyf0/o.jpg"
      width="120"
    />
  </a>

  {% endif %} {% comment %} ajax method 는 POST로 바꿔줘야 함 {% endcomment %}

  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
</div>

{% endblock %}
